name <- stringr::str_remove(name, "LPG[/|C]*[\\W]*|LNG[/|C]*[\\W]*") ## LPG/LNG variations
name <- stringr::str_remove(name, "(\\s|^)F[^\\w\\s]*V[^\\w]*")  ## fishing vessel code in English (F/V, F-V, F.V, FV: etc)
name <- stringr::str_remove(name, "^F[^\\w\\s]*B[^\\w]+")  ## fishing vessel code in English
name <- stringr::str_remove(name, " F[^\\w\\s]*B[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*P[^\\w]+")  ## fishing vessel code in Italy/Spain
name <- stringr::str_remove(name, " M[^\\w\\s]*P[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*B[^\\w]+")  ## fishing vessel code in Italy/Spain
name <- stringr::str_remove(name, " M[^\\w\\s]*B[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^G[^\\w\\s]*V[^\\w]+")  ## mostly in UK
name <- stringr::str_remove(name, "S+F+[^\\w]+G[^\\w\\s]*V[^\\w]*")
name <- stringr::str_remove(name, " G[^\\w\\s]*V[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*V[^\\w]+")  ## in English
name <- stringr::str_remove(name, " M[^\\w\\s]*V[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]+S[^\\w]+")  ## Merchant Ship
name <- stringr::str_remove(name, " M[^\\w\\s]+S[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*K[^\\w]+")  ## mostly in northern europe
name <- stringr::str_remove(name, " M[^\\w\\s]+K[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^R[^\\w\\s]*V[^\\w]+")  ## Research Vessel
name <- stringr::str_remove(name, " R[^\\w\\s]*V[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^T[^\\w\\s]*T[^\\w]+")  ## Tender To
name <- stringr::str_remove(name, " T[^\\w\\s]*T[^\\w]*($)")
name <- stringr::str_remove(name, "^S[^\\w\\s]*Y[^\\w]+")  ## Steam Yacht
name <- stringr::str_remove(name, " S[^\\w\\s]*Y[^\\w]*($)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*F[^\\w]+")  ## Motor Ferry
name <- stringr::str_remove(name, " M[^\\w\\s]*F[^\\w]*($)")
name <- stringr::str_remove(name, "^S[^\\w\\s]*S[^\\w]+")  ## Steam Ship
name <- stringr::str_remove(name, " S[^\\w\\s]*S[^\\w]*($)")
name <- stringr::str_remove(name, "^S[^\\w\\s]*V[^\\w]+")  ## Sailing Vessel
name <- stringr::str_remove(name, " S[^\\w\\s]*V[^\\w]*($)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*T[^\\w]+")  ## Motor Tanker
name <- stringr::str_remove(name, " M[^\\w\\s]*T[^\\w]*($)")
name <- stringr::str_remove(name, "^M[^\\w\\s]+Y[^\\w]+")  ## Motor Yacht
name <- stringr::str_remove(name, " M[^\\w\\s]+Y[^\\w]*($)")
name <- stringr::str_remove(name, "^[A-Z]/[A-Z][^\\w]+")  ## All other types of X/X
name <- stringr::str_remove(name, " [A-Z]/[A-Z]($)")
name <- stringr::str_remove(name, "^[A-Z]\\\\[A-Z][^\\w]+")  ## All other types of X\X
name <- stringr::str_remove(name, " [A-Z]\\\\[A-Z]($)")
name <- stringr::str_remove(name, "\\(.+\\)")  ## All additional information in parentheses
name <- stringr::str_remove(name, "\\[.+\\]")
## numbers in letters
name <- stringr::str_replace(name, " ONE($)| UNO($)| UN($)", " 1")
name <- stringr::str_replace(name, " TWO($)| DOS($)| DEUX($)", " 2")
name <- stringr::str_replace(name, " THREE($)| TRES($)| TROIS($)", " 3")
name <- stringr::str_replace(name, " FOUR($)| CUATRO($)| QUATRE($)", " 4")
name <- stringr::str_replace(name, " FIVE($)| CINCO($)| CINQ($)", " 5")
name <- stringr::str_replace(name, " SIX($)| SEIS($)| SIX($)", " 6")
name <- stringr::str_replace(name, " SEVEN($)| SIETE($)| SEPT($)", " 7")
name <- stringr::str_replace(name, " EIGHT($)| OCHO($)| HUIT($)", " 8")
name <- stringr::str_replace(name, " NINE($)| NUEVE($)| NEUF($)", " 9")
name <- stringr::str_replace(name, " TEN($)| DIEZ($)| DIX($)", " 10")
name <- stringr::str_replace(name, " ELEVEN($)| ONCE($)| ONZE($)", " 11")
name <- stringr::str_replace(name, " TWELVE($)| DOCE($)| DOUZE($)", " 12")
name <- stringr::str_replace(name, " THIRTEEN($)| TRECE($)| TREIZE($)", " 13")
name <- stringr::str_replace(name, " FOURTEEN($)| CATORCE($)| QUATORZE($)", " 14")
name <- stringr::str_replace(name, " FIFTEEN($)| QUINCE($)| QUINZE($)", " 15")
## country specific appendix (korea)
name <- stringr::str_replace(name, " HO($)", " ")
## remove NO.s such in NO.5, NO5, NO:5, NO. 5, NO 5, N5, N-5 etc
name <- stringr::str_remove(name, "NO[^\\w\\s]*[\\s]*(?=\\d+)")
name <- stringr::str_remove(name, "[\\s]+N[\\W_0]*(?=\\d+)")
name <- stringr::str_remove(name, "NO\\.\\s*(?=[^0-9]+)")
## turn "&" to "AND"
name <- stringr::str_replace(name, "(?<=[A-Z])\\s+&\\s+(?=[A-Z])", " AND ") ## replace "BLACK & WHITE" to "BLACK AND WHITE"
## deromanization
vs <- stringr::str_split(name, "\\s+|-|(?<=[A-Z]{3})\\.")
## if last word from the name text has L/C/D/M then do not deromanize
if (!stringr::str_detect(vs[[1]][length(vs[[1]])], "[LCDM]")){
vs[[1]][length(vs[[1]])] <- as.roman(vs[[1]][length(vs[[1]])])
if(!is.na(vs[[1]][length(vs[[1]])])){
vs[[1]][length(vs[[1]])] <- as.numeric(vs[[1]][length(vs[[1]])])
## attach the deromanized digits to the end
name <- paste(vs[[1]], collapse = " ")
}
## now, remove all special characters
name <- stringr::str_remove(name, "[\\W_]")
## check if the name starts with digits, if yes move it to the end
if(stringr::str_detect(name, "^\\d")){
name <- paste(stringr::str_remove(name, "^\\d+"), stringr::str_extract(name, "^\\d+"))
}
## remove 0s from the numbers starting with 0s
if(stringr::str_detect(name, "\\d+$")){
sufix <- stringr::str_extract(name, "\\d+$")
non_zeros <- stringr::str_remove_all(sufix, "^0+")
name <- stringr::str_replace(name, sufix, non_zeros)
}
name <- stringr::str_remove_all(name, "[:punct:]")
name <- stringr::str_squish(name)
name <- stringr::str_trim(name)
if (name == ""){return(NA)}
return(name)
}
result = normalize_shipname("weird -+%()<>$;!&'`\\.#/")
result
#' Normalize shipname
#'
#' @description Performs a series of string normalizations to get a clean shipname
#'
#' @param name A character string (or vecctor of strings) to be normalized
#'
#' @return A normmalized name
#' @export
#'
normalize_shipname <- function(name) {
if (is.na(name) | (name != name) | (name == "")){
return(NA)
}
## turn to upper cases
name <- toupper(name)
## remove nasty charcters, white space
name <- UnidecodeR::unidecode(name, language = "all")
name <- stringr::str_squish(name)
name <- stringr::str_trim(name)
name <- stringr::str_remove(name, "\n")
name <- stringr::str_remove(name, "\r")
## remove fishing vessel code
name <- stringr::str_remove(name, "MFV[^\\w]+") ## fishing vessel code in English
name <- stringr::str_remove(name, "MPV[^\\w]+") ## fishing vessel code in English
name <- stringr::str_remove(name, "HMS[^\\w]+") ## fishing vessel code in English
name <- stringr::str_remove(name, "LPG[/|C]*[\\W]*|LNG[/|C]*[\\W]*") ## LPG/LNG variations
name <- stringr::str_remove(name, "(\\s|^)F[^\\w\\s]*V[^\\w]*")  ## fishing vessel code in English (F/V, F-V, F.V, FV: etc)
name <- stringr::str_remove(name, "^F[^\\w\\s]*B[^\\w]+")  ## fishing vessel code in English
name <- stringr::str_remove(name, " F[^\\w\\s]*B[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*P[^\\w]+")  ## fishing vessel code in Italy/Spain
name <- stringr::str_remove(name, " M[^\\w\\s]*P[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*B[^\\w]+")  ## fishing vessel code in Italy/Spain
name <- stringr::str_remove(name, " M[^\\w\\s]*B[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^G[^\\w\\s]*V[^\\w]+")  ## mostly in UK
name <- stringr::str_remove(name, "S+F+[^\\w]+G[^\\w\\s]*V[^\\w]*")
name <- stringr::str_remove(name, " G[^\\w\\s]*V[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*V[^\\w]+")  ## in English
name <- stringr::str_remove(name, " M[^\\w\\s]*V[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]+S[^\\w]+")  ## Merchant Ship
name <- stringr::str_remove(name, " M[^\\w\\s]+S[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*K[^\\w]+")  ## mostly in northern europe
name <- stringr::str_remove(name, " M[^\\w\\s]+K[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^R[^\\w\\s]*V[^\\w]+")  ## Research Vessel
name <- stringr::str_remove(name, " R[^\\w\\s]*V[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^T[^\\w\\s]*T[^\\w]+")  ## Tender To
name <- stringr::str_remove(name, " T[^\\w\\s]*T[^\\w]*($)")
name <- stringr::str_remove(name, "^S[^\\w\\s]*Y[^\\w]+")  ## Steam Yacht
name <- stringr::str_remove(name, " S[^\\w\\s]*Y[^\\w]*($)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*F[^\\w]+")  ## Motor Ferry
name <- stringr::str_remove(name, " M[^\\w\\s]*F[^\\w]*($)")
name <- stringr::str_remove(name, "^S[^\\w\\s]*S[^\\w]+")  ## Steam Ship
name <- stringr::str_remove(name, " S[^\\w\\s]*S[^\\w]*($)")
name <- stringr::str_remove(name, "^S[^\\w\\s]*V[^\\w]+")  ## Sailing Vessel
name <- stringr::str_remove(name, " S[^\\w\\s]*V[^\\w]*($)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*T[^\\w]+")  ## Motor Tanker
name <- stringr::str_remove(name, " M[^\\w\\s]*T[^\\w]*($)")
name <- stringr::str_remove(name, "^M[^\\w\\s]+Y[^\\w]+")  ## Motor Yacht
name <- stringr::str_remove(name, " M[^\\w\\s]+Y[^\\w]*($)")
name <- stringr::str_remove(name, "^[A-Z]/[A-Z][^\\w]+")  ## All other types of X/X
name <- stringr::str_remove(name, " [A-Z]/[A-Z]($)")
name <- stringr::str_remove(name, "^[A-Z]\\\\[A-Z][^\\w]+")  ## All other types of X\X
name <- stringr::str_remove(name, " [A-Z]\\\\[A-Z]($)")
name <- stringr::str_remove(name, "\\(.+\\)")  ## All additional information in parentheses
name <- stringr::str_remove(name, "\\[.+\\]")
## numbers in letters
name <- stringr::str_replace(name, " ONE($)| UNO($)| UN($)", " 1")
name <- stringr::str_replace(name, " TWO($)| DOS($)| DEUX($)", " 2")
name <- stringr::str_replace(name, " THREE($)| TRES($)| TROIS($)", " 3")
name <- stringr::str_replace(name, " FOUR($)| CUATRO($)| QUATRE($)", " 4")
name <- stringr::str_replace(name, " FIVE($)| CINCO($)| CINQ($)", " 5")
name <- stringr::str_replace(name, " SIX($)| SEIS($)| SIX($)", " 6")
name <- stringr::str_replace(name, " SEVEN($)| SIETE($)| SEPT($)", " 7")
name <- stringr::str_replace(name, " EIGHT($)| OCHO($)| HUIT($)", " 8")
name <- stringr::str_replace(name, " NINE($)| NUEVE($)| NEUF($)", " 9")
name <- stringr::str_replace(name, " TEN($)| DIEZ($)| DIX($)", " 10")
name <- stringr::str_replace(name, " ELEVEN($)| ONCE($)| ONZE($)", " 11")
name <- stringr::str_replace(name, " TWELVE($)| DOCE($)| DOUZE($)", " 12")
name <- stringr::str_replace(name, " THIRTEEN($)| TRECE($)| TREIZE($)", " 13")
name <- stringr::str_replace(name, " FOURTEEN($)| CATORCE($)| QUATORZE($)", " 14")
name <- stringr::str_replace(name, " FIFTEEN($)| QUINCE($)| QUINZE($)", " 15")
## country specific appendix (korea)
name <- stringr::str_replace(name, " HO($)", " ")
## remove NO.s such in NO.5, NO5, NO:5, NO. 5, NO 5, N5, N-5 etc
name <- stringr::str_remove(name, "NO[^\\w\\s]*[\\s]*(?=\\d+)")
name <- stringr::str_remove(name, "[\\s]+N[\\W_0]*(?=\\d+)")
name <- stringr::str_remove(name, "NO\\.\\s*(?=[^0-9]+)")
## turn "&" to "AND"
name <- stringr::str_replace(name, "(?<=[A-Z])\\s+&\\s+(?=[A-Z])", " AND ") ## replace "BLACK & WHITE" to "BLACK AND WHITE"
## deromanization
vs <- stringr::str_split(name, "\\s+|-|(?<=[A-Z]{3})\\.")
## if last word from the name text has L/C/D/M then do not deromanize
if (!stringr::str_detect(vs[[1]][length(vs[[1]])], "[LCDM]")){
vs[[1]][length(vs[[1]])] <- as.roman(vs[[1]][length(vs[[1]])])
if(!is.na(vs[[1]][length(vs[[1]])])){
vs[[1]][length(vs[[1]])] <- as.numeric(vs[[1]][length(vs[[1]])])
## attach the deromanized digits to the end
name <- paste(vs[[1]], collapse = " ")
}
## now, remove all special characters
name <- stringr::str_remove(name, "[\\W_]")
## check if the name starts with digits, if yes move it to the end
if(stringr::str_detect(name, "^\\d")){
name <- paste(stringr::str_remove(name, "^\\d+"), stringr::str_extract(name, "^\\d+"))
}
## remove 0s from the numbers starting with 0s
if(stringr::str_detect(name, "\\d+$")){
sufix <- stringr::str_extract(name, "\\d+$")
non_zeros <- stringr::str_remove_all(sufix, "^0+")
name <- stringr::str_replace(name, sufix, non_zeros)
}
name <- stringr::str_remove_all(name, "[:punct:]+")
name <- stringr::str_squish(name)
name <- stringr::str_trim(name)
if (name == ""){return(NA)}
return(name)
}
result = normalize_shipname("weird -+%()<>$;!&'`\\.#/")
result
name
name <- "weird -+%()<>$;!&'`\\.#/"
## now, remove all special characters
name <- stringr::str_remove(name, "[\\W_]")
name
#' Normalize shipname
#'
#' @description Performs a series of string normalizations to get a clean shipname
#'
#' @param name A character string (or vecctor of strings) to be normalized
#'
#' @return A normmalized name
#' @export
#'
normalize_shipname <- function(name) {
if (is.na(name) | (name != name) | (name == "")){
return(NA)
}
## turn to upper cases
name <- toupper(name)
## remove nasty charcters, white space
name <- UnidecodeR::unidecode(name, language = "all")
name <- stringr::str_squish(name)
name <- stringr::str_trim(name)
name <- stringr::str_remove(name, "\n")
name <- stringr::str_remove(name, "\r")
## remove fishing vessel code
name <- stringr::str_remove(name, "MFV[^\\w]+") ## fishing vessel code in English
name <- stringr::str_remove(name, "MPV[^\\w]+") ## fishing vessel code in English
name <- stringr::str_remove(name, "HMS[^\\w]+") ## fishing vessel code in English
name <- stringr::str_remove(name, "LPG[/|C]*[\\W]*|LNG[/|C]*[\\W]*") ## LPG/LNG variations
name <- stringr::str_remove(name, "(\\s|^)F[^\\w\\s]*V[^\\w]*")  ## fishing vessel code in English (F/V, F-V, F.V, FV: etc)
name <- stringr::str_remove(name, "^F[^\\w\\s]*B[^\\w]+")  ## fishing vessel code in English
name <- stringr::str_remove(name, " F[^\\w\\s]*B[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*P[^\\w]+")  ## fishing vessel code in Italy/Spain
name <- stringr::str_remove(name, " M[^\\w\\s]*P[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*B[^\\w]+")  ## fishing vessel code in Italy/Spain
name <- stringr::str_remove(name, " M[^\\w\\s]*B[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^G[^\\w\\s]*V[^\\w]+")  ## mostly in UK
name <- stringr::str_remove(name, "S+F+[^\\w]+G[^\\w\\s]*V[^\\w]*")
name <- stringr::str_remove(name, " G[^\\w\\s]*V[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*V[^\\w]+")  ## in English
name <- stringr::str_remove(name, " M[^\\w\\s]*V[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]+S[^\\w]+")  ## Merchant Ship
name <- stringr::str_remove(name, " M[^\\w\\s]+S[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*K[^\\w]+")  ## mostly in northern europe
name <- stringr::str_remove(name, " M[^\\w\\s]+K[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^R[^\\w\\s]*V[^\\w]+")  ## Research Vessel
name <- stringr::str_remove(name, " R[^\\w\\s]*V[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^T[^\\w\\s]*T[^\\w]+")  ## Tender To
name <- stringr::str_remove(name, " T[^\\w\\s]*T[^\\w]*($)")
name <- stringr::str_remove(name, "^S[^\\w\\s]*Y[^\\w]+")  ## Steam Yacht
name <- stringr::str_remove(name, " S[^\\w\\s]*Y[^\\w]*($)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*F[^\\w]+")  ## Motor Ferry
name <- stringr::str_remove(name, " M[^\\w\\s]*F[^\\w]*($)")
name <- stringr::str_remove(name, "^S[^\\w\\s]*S[^\\w]+")  ## Steam Ship
name <- stringr::str_remove(name, " S[^\\w\\s]*S[^\\w]*($)")
name <- stringr::str_remove(name, "^S[^\\w\\s]*V[^\\w]+")  ## Sailing Vessel
name <- stringr::str_remove(name, " S[^\\w\\s]*V[^\\w]*($)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*T[^\\w]+")  ## Motor Tanker
name <- stringr::str_remove(name, " M[^\\w\\s]*T[^\\w]*($)")
name <- stringr::str_remove(name, "^M[^\\w\\s]+Y[^\\w]+")  ## Motor Yacht
name <- stringr::str_remove(name, " M[^\\w\\s]+Y[^\\w]*($)")
name <- stringr::str_remove(name, "^[A-Z]/[A-Z][^\\w]+")  ## All other types of X/X
name <- stringr::str_remove(name, " [A-Z]/[A-Z]($)")
name <- stringr::str_remove(name, "^[A-Z]\\\\[A-Z][^\\w]+")  ## All other types of X\X
name <- stringr::str_remove(name, " [A-Z]\\\\[A-Z]($)")
name <- stringr::str_remove(name, "\\(.+\\)")  ## All additional information in parentheses
name <- stringr::str_remove(name, "\\[.+\\]")
## numbers in letters
name <- stringr::str_replace(name, " ONE($)| UNO($)| UN($)", " 1")
name <- stringr::str_replace(name, " TWO($)| DOS($)| DEUX($)", " 2")
name <- stringr::str_replace(name, " THREE($)| TRES($)| TROIS($)", " 3")
name <- stringr::str_replace(name, " FOUR($)| CUATRO($)| QUATRE($)", " 4")
name <- stringr::str_replace(name, " FIVE($)| CINCO($)| CINQ($)", " 5")
name <- stringr::str_replace(name, " SIX($)| SEIS($)| SIX($)", " 6")
name <- stringr::str_replace(name, " SEVEN($)| SIETE($)| SEPT($)", " 7")
name <- stringr::str_replace(name, " EIGHT($)| OCHO($)| HUIT($)", " 8")
name <- stringr::str_replace(name, " NINE($)| NUEVE($)| NEUF($)", " 9")
name <- stringr::str_replace(name, " TEN($)| DIEZ($)| DIX($)", " 10")
name <- stringr::str_replace(name, " ELEVEN($)| ONCE($)| ONZE($)", " 11")
name <- stringr::str_replace(name, " TWELVE($)| DOCE($)| DOUZE($)", " 12")
name <- stringr::str_replace(name, " THIRTEEN($)| TRECE($)| TREIZE($)", " 13")
name <- stringr::str_replace(name, " FOURTEEN($)| CATORCE($)| QUATORZE($)", " 14")
name <- stringr::str_replace(name, " FIFTEEN($)| QUINCE($)| QUINZE($)", " 15")
## country specific appendix (korea)
name <- stringr::str_replace(name, " HO($)", " ")
## remove NO.s such in NO.5, NO5, NO:5, NO. 5, NO 5, N5, N-5 etc
name <- stringr::str_remove(name, "NO[^\\w\\s]*[\\s]*(?=\\d+)")
name <- stringr::str_remove(name, "[\\s]+N[\\W_0]*(?=\\d+)")
name <- stringr::str_remove(name, "NO\\.\\s*(?=[^0-9]+)")
## turn "&" to "AND"
name <- stringr::str_replace(name, "(?<=[A-Z])\\s+&\\s+(?=[A-Z])", " AND ") ## replace "BLACK & WHITE" to "BLACK AND WHITE"
## deromanization
vs <- stringr::str_split(name, "\\s+|-|(?<=[A-Z]{3})\\.")
## if last word from the name text has L/C/D/M then do not deromanize
if (!stringr::str_detect(vs[[1]][length(vs[[1]])], "[LCDM]")){
vs[[1]][length(vs[[1]])] <- as.roman(vs[[1]][length(vs[[1]])])
if(!is.na(vs[[1]][length(vs[[1]])])){
vs[[1]][length(vs[[1]])] <- as.numeric(vs[[1]][length(vs[[1]])])
## attach the deromanized digits to the end
name <- paste(vs[[1]], collapse = " ")
}
## now, remove all special characters
name <- stringr::str_remove(name, "[\\W_]")
## check if the name starts with digits, if yes move it to the end
if(stringr::str_detect(name, "^\\d")){
name <- paste(stringr::str_remove(name, "^\\d+"), stringr::str_extract(name, "^\\d+"))
}
## remove 0s from the numbers starting with 0s
if(stringr::str_detect(name, "\\d+$")){
sufix <- stringr::str_extract(name, "\\d+$")
non_zeros <- stringr::str_remove_all(sufix, "^0+")
name <- stringr::str_replace(name, sufix, non_zeros)
}
name <- stringr::str_remove_all(name, "[[:punct:]]+")
name <- stringr::str_squish(name)
name <- stringr::str_trim(name)
if (name == ""){return(NA)}
return(name)
}
result = normalize_shipname("weird -+%()<>$;!&'`\\.#/")
result
name <- stringr::str_remove_all(name, "[^[:alnum:]]")
name
source('~/GitHub/startR/R/normalize_shipname.R', echo=TRUE)
normalize_shipname <- function(name) {
if (is.na(name) | (name != name) | (name == "")){
return(NA)
}
## turn to upper cases
name <- toupper(name)
## remove nasty charcters, white space
name <- UnidecodeR::unidecode(name, language = "all")
name <- stringr::str_squish(name)
name <- stringr::str_trim(name)
name <- stringr::str_remove(name, "\n")
name <- stringr::str_remove(name, "\r")
## remove fishing vessel code
name <- stringr::str_remove(name, "MFV[^\\w]+") ## fishing vessel code in English
name <- stringr::str_remove(name, "MPV[^\\w]+") ## fishing vessel code in English
name <- stringr::str_remove(name, "HMS[^\\w]+") ## fishing vessel code in English
name <- stringr::str_remove(name, "LPG[/|C]*[\\W]*|LNG[/|C]*[\\W]*") ## LPG/LNG variations
name <- stringr::str_remove(name, "(\\s|^)F[^\\w\\s]*V[^\\w]*")  ## fishing vessel code in English (F/V, F-V, F.V, FV: etc)
name <- stringr::str_remove(name, "^F[^\\w\\s]*B[^\\w]+")  ## fishing vessel code in English
name <- stringr::str_remove(name, " F[^\\w\\s]*B[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*P[^\\w]+")  ## fishing vessel code in Italy/Spain
name <- stringr::str_remove(name, " M[^\\w\\s]*P[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*B[^\\w]+")  ## fishing vessel code in Italy/Spain
name <- stringr::str_remove(name, " M[^\\w\\s]*B[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^G[^\\w\\s]*V[^\\w]+")  ## mostly in UK
name <- stringr::str_remove(name, "S+F+[^\\w]+G[^\\w\\s]*V[^\\w]*")
name <- stringr::str_remove(name, " G[^\\w\\s]*V[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*V[^\\w]+")  ## in English
name <- stringr::str_remove(name, " M[^\\w\\s]*V[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]+S[^\\w]+")  ## Merchant Ship
name <- stringr::str_remove(name, " M[^\\w\\s]+S[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*K[^\\w]+")  ## mostly in northern europe
name <- stringr::str_remove(name, " M[^\\w\\s]+K[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^R[^\\w\\s]*V[^\\w]+")  ## Research Vessel
name <- stringr::str_remove(name, " R[^\\w\\s]*V[^\\w]*(\\s|$)")
name <- stringr::str_remove(name, "^T[^\\w\\s]*T[^\\w]+")  ## Tender To
name <- stringr::str_remove(name, " T[^\\w\\s]*T[^\\w]*($)")
name <- stringr::str_remove(name, "^S[^\\w\\s]*Y[^\\w]+")  ## Steam Yacht
name <- stringr::str_remove(name, " S[^\\w\\s]*Y[^\\w]*($)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*F[^\\w]+")  ## Motor Ferry
name <- stringr::str_remove(name, " M[^\\w\\s]*F[^\\w]*($)")
name <- stringr::str_remove(name, "^S[^\\w\\s]*S[^\\w]+")  ## Steam Ship
name <- stringr::str_remove(name, " S[^\\w\\s]*S[^\\w]*($)")
name <- stringr::str_remove(name, "^S[^\\w\\s]*V[^\\w]+")  ## Sailing Vessel
name <- stringr::str_remove(name, " S[^\\w\\s]*V[^\\w]*($)")
name <- stringr::str_remove(name, "^M[^\\w\\s]*T[^\\w]+")  ## Motor Tanker
name <- stringr::str_remove(name, " M[^\\w\\s]*T[^\\w]*($)")
name <- stringr::str_remove(name, "^M[^\\w\\s]+Y[^\\w]+")  ## Motor Yacht
name <- stringr::str_remove(name, " M[^\\w\\s]+Y[^\\w]*($)")
name <- stringr::str_remove(name, "^[A-Z]/[A-Z][^\\w]+")  ## All other types of X/X
name <- stringr::str_remove(name, " [A-Z]/[A-Z]($)")
name <- stringr::str_remove(name, "^[A-Z]\\\\[A-Z][^\\w]+")  ## All other types of X\X
name <- stringr::str_remove(name, " [A-Z]\\\\[A-Z]($)")
name <- stringr::str_remove(name, "\\(.+\\)")  ## All additional information in parentheses
name <- stringr::str_remove(name, "\\[.+\\]")
## numbers in letters
name <- stringr::str_replace(name, " ONE($)| UNO($)| UN($)", " 1")
name <- stringr::str_replace(name, " TWO($)| DOS($)| DEUX($)", " 2")
name <- stringr::str_replace(name, " THREE($)| TRES($)| TROIS($)", " 3")
name <- stringr::str_replace(name, " FOUR($)| CUATRO($)| QUATRE($)", " 4")
name <- stringr::str_replace(name, " FIVE($)| CINCO($)| CINQ($)", " 5")
name <- stringr::str_replace(name, " SIX($)| SEIS($)| SIX($)", " 6")
name <- stringr::str_replace(name, " SEVEN($)| SIETE($)| SEPT($)", " 7")
name <- stringr::str_replace(name, " EIGHT($)| OCHO($)| HUIT($)", " 8")
name <- stringr::str_replace(name, " NINE($)| NUEVE($)| NEUF($)", " 9")
name <- stringr::str_replace(name, " TEN($)| DIEZ($)| DIX($)", " 10")
name <- stringr::str_replace(name, " ELEVEN($)| ONCE($)| ONZE($)", " 11")
name <- stringr::str_replace(name, " TWELVE($)| DOCE($)| DOUZE($)", " 12")
name <- stringr::str_replace(name, " THIRTEEN($)| TRECE($)| TREIZE($)", " 13")
name <- stringr::str_replace(name, " FOURTEEN($)| CATORCE($)| QUATORZE($)", " 14")
name <- stringr::str_replace(name, " FIFTEEN($)| QUINCE($)| QUINZE($)", " 15")
## country specific appendix (korea)
name <- stringr::str_replace(name, " HO($)", " ")
## remove NO.s such in NO.5, NO5, NO:5, NO. 5, NO 5, N5, N-5 etc
name <- stringr::str_remove(name, "NO[^\\w\\s]*[\\s]*(?=\\d+)")
name <- stringr::str_remove(name, "[\\s]+N[\\W_0]*(?=\\d+)")
name <- stringr::str_remove(name, "NO\\.\\s*(?=[^0-9]+)")
## turn "&" to "AND"
name <- stringr::str_replace(name, "(?<=[A-Z])\\s+&\\s+(?=[A-Z])", " AND ") ## replace "BLACK & WHITE" to "BLACK AND WHITE"
## deromanization
vs <- stringr::str_split(name, "\\s+|-|(?<=[A-Z]{3})\\.")
## if last word from the name text has L/C/D/M then do not deromanize
if (!stringr::str_detect(vs[[1]][length(vs[[1]])], "[LCDM]")){
vs[[1]][length(vs[[1]])] <- as.roman(vs[[1]][length(vs[[1]])])
if(!is.na(vs[[1]][length(vs[[1]])])){
vs[[1]][length(vs[[1]])] <- as.numeric(vs[[1]][length(vs[[1]])])
## attach the deromanized digits to the end
name <- paste(vs[[1]], collapse = " ")
}
## now, remove all special characters
name <- stringr::str_remove(name, "[\\W_]")
## check if the name starts with digits, if yes move it to the end
if(stringr::str_detect(name, "^\\d")){
name <- paste(stringr::str_remove(name, "^\\d+"), stringr::str_extract(name, "^\\d+"))
}
## remove 0s from the numbers starting with 0s
if(stringr::str_detect(name, "\\d+$")){
sufix <- stringr::str_extract(name, "\\d+$")
non_zeros <- stringr::str_remove_all(sufix, "^0+")
name <- stringr::str_replace(name, sufix, non_zeros)
}
name <- stringr::str_remove_all(name, "[^[:alnum:]]")
name <- stringr::str_squish(name)
name <- stringr::str_trim(name)
if (name == ""){return(NA)}
return(name)
}
result = normalize_shipname("weird -+%()<>$;!&'`\\.#/")
result
result = normalize_shipname("weird -+%()<>$;!&'`\\.#/")
result == "WEIRD"
result = normalize_shipname("  \tspaced  \nname      ")
result == "SPACEDNAME"
result = normalize_shipname("f/b boat f/v othername")
result == "BOATOTHERNAME"
result = normalize_shipname("r/v boat othername")
result == "BOATOTHERNAME"
result = normalize_shipname("no. boat")
result == "BOAT"
result = normalize_shipname("no537 boat")
result == 'BOAT537'
result = normalize_shipname("boat IX")
result == "BOAT9"
result = normalize_shipname("")
result == NA
is.na(result)
result = normalize_shipname("a")
result == "A"
result = normalize_shipname("no")
result == "NO"
devtools::use_testthat()
install.packages("testthat")
devtools::use_testthat()
library(testthat)
person("Juan Carlos", "Villaseñor-Derbez", email = "juancarlos@ucsb.edu",
role = c("aut", "cre"))
expect_equal(normalize_shipname("MixEd"), "MIXED")
normalize_shipname("MixEd"), "MIXED"
normalize_shipname("MixEd")
devtools::test()
## if last word from the name text has L/C/D/M then do not deromanize
if (!stringr::str_detect(vs[[1]][length(vs[[1]])], "[LCDM]")){
if(stringr::str_detect(vs[[1]][length(vs[[1]])], "[IVX]")){
vs[[1]][length(vs[[1]])] <- as.roman(vs[[1]][length(vs[[1]])])
if(!is.na(vs[[1]][length(vs[[1]])])){
vs[[1]][length(vs[[1]])] <- as.numeric(vs[[1]][length(vs[[1]])])
## attach the deromanized digits to the end
name <- paste(vs[[1]], collapse = " ")
}
devtools::test()
?import
?roxygen
?roxygen2
devtools::document()
UnidecodeR::get_transliterations(language = "all")
UnidecodeR::get_transliterations(language = "german")
UnidecodeR::get_transliterations(language = "english")
UnidecodeR::get_transliterations(language = "slovene")
UnidecodeR::get_transliterations(language = "sl")
UnidecodeR::get_transliterations(language = "all")
UnidecodeR::unidecode(name, language = "all")
name
name <- "MiXeD524"
UnidecodeR::unidecode(name, language = "all")
unidecode(name, language = "all")
UnidecodeR::unidecode(name, language = "all")
unidecode(name, language = "all")
library(UnidecodeR)
unidecode(name, language = "all")
name <- "MiXeD524"
unidecode(name, language = "all")
source('~/GitHub/startR/R/ggtheme_plot.R')
devtools::document()
library(startR)
normalize_shipname("MFV weird -+%()<>$;!&'\\.#/ boatname IV")
